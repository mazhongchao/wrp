# WRP

A system for work recording and planning.This system requires both Python3.9 and Django4.2.


## Installation
```bash
pip install -r requirements.txt
```


## External dependencies
* Nginx (for production environment)
* uWSGI（for production environment）
* SQLite3 or MySQL8
* wkhtmltopdf
* google-chrome
* chromedriver

Install uWSGI
```bash
wget https://github.com/unbit/uwsgi/archive/refs/tags/2.0.21.tar.gz
tar zxf uwsgi-2.0.21.tar.gz
cd uwsgi-2.0.21
python3 uwsgiconfig.py --build
python3 setup.py install
```

Install `wkhtmltopdf`:
```bash
# for AlmaLinux 9
wget https://github.com/wkhtmltopdf/packaging/releases/download/0.12.6.1-2/wkhtmltox-0.12.6.1-2.almalinux9.x86_64.rpm
rpm -ivh wkhtmltox-0.12.6.1-2.almalinux9.x86_64.rpm

# after installation of wkhtmltopdf
sudo dnf install xorg-x11-fonts-75dpi
sudo dnf install xorg-x11-fonts-Type1
```

The charts generated by `pyecharts` cannot be displayed as a image in the PDF file generated by `wkhtmltopdf` from HTML, so use `snapshot_selenium` to generate a image of the charts, and then use the image in HTML file, and `snapshot_selenium` requires `google-chrome` binary files and `chromedriver`.

Install `google-chrome` and `chromedriver`:
```bash
# for AlmaLinux 9
# google-chrome
wget https://dl.google.com/linux/direct/google-chrome-stable_current_x86_64.rpm
sudo dnf install google-chrome-stable_current_x86_64.rpm

# chromedriver
wget https://chromedriver.storage.googleapis.com/114.0.5735.90/chromedriver_linux64.zip
upzip chromedriver_linux64.zip
```


## Start
* Development or test environment
```bash
# for Linux:
./manage.py makemigrations
./manage.py migrate
./manage.py createsuperuser

./manage.py runserver 
```
Visit `http://127.0.0.1:8000`.

* Production environment

uWSGI
```bash
[uwsgi]
chdir=/<PATH>/<TO>/wrp
module=wrp.wsgi:application
socket=127.0.0.1:[<YOUR_PORT>]
master=true
processes=2
pidfile=/<PATH>/<TO>/uwsgi.pid
daemonize=/<PATH>/<TO>/run.log
disable-logging=true
```

Nginx

```bash
server
{
    listen <YOUR_PORT>;
    server_name <YOUR_HOST>;

    charset utf-8;

    access_log  /var/log/nginx/wrp-access.log main;
    error_log   /var/log/nginx/wrp-error.log  error;

    location / {
        include  /etc/nginx/uwsgi_params;
        uwsgi_pass  <YOUR_UWSGI_HOST_PORT>;
    }
    location /static {
        alias /<PATH>/<TO>/wrp/static;
    }
    location /media {
        alias /<PATH>/<TO>/wrp/media;
    }
    location /upload {
        alias /<PATH>/<TO>/wrp/upload;
    }
}
```

To startup the application:
```bash
./manage.py makemigrations
./manage.py migrate
./manage.py createsuperuser

uwsgi --ini <PATH_TO>/uwsgi.ini
```
and then visit `http://<YOUR_HOST>[:<YOUR_PORT>]/admin` to open the application.